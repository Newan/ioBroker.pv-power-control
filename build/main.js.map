{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from '@iobroker/adapter-core';\r\n\r\nclass PvPowerConrol extends utils.Adapter {\r\n\r\n    private watchdogInterval!: ioBroker.Interval ; //Intervall f\u00FCr Abfrage des Smatmeters und steuern der Wallbox\r\n    private startTimer!: ioBroker.Timeout; //Timer f\u00FCr Start der PV Ladung\r\n    private stopTimer!: ioBroker.Timeout; //Timer f\u00FCr Stop der PV Ladung\r\n    private gridFactor = 1; //Smatmeter factor zum umrechenen\r\n    private currentPower = 0; //Strom einspeisung oder bezug?\r\n    private isPluged = false; //Auto angeschlossen?\r\n    private vehicleSoc = 0; //Ladesatnd des Autos\r\n    private stepAmpereWallbox = 1; //Mindestampere f\u00FCr eine Ampere hochschalten an der Wallbox\r\n    private wallboxAmpereComplete = 0; //Aktuelle Ampereleistung Wallbox aller Phasen\r\n    private wallboxAmpereP1 = 0; //Aktuelle Ampereleistung Wallbox Phase 1\r\n    private wallboxAmpereP2 = 0; //Aktuelle Ampereleistung Wallbox Phase 2\r\n    private wallboxAmpereP3 = 0; //Aktuelle Ampereleistung Wallbox Phase 3\r\n    //private wallboxEnable = false; //Aktuellen Wallboxstatus\r\n    private minWallboxAmpere = 2 // Mindestampere zum Laden;\r\n    private maxWallboxAmpere = 32 // MaximalAmpere f\u00FCr Wallbox\r\n    private mode ='stop' // stop = Keine Ladung erfolgt, start=warten auf start, pv = Sind m PV Lademodus\r\n\r\n    private stopTime = 5000; //Timer bis Laden beendet wird\r\n    private startTime = 15000; //Timer bis LAden gestartet wird\r\n    private intervalTime = 10000; //Intervall wie h\u00E4ufig der LAdestrom angepasst wird\r\n\r\n    private runStopTimer = false;\r\n    private runStartTimer = false;\r\n\r\n\r\n    public constructor(options: Partial<utils.AdapterOptions> = {}) {\r\n        super({\r\n            ...options,\r\n            name: 'pv-power-control',\r\n        });\r\n        this.on('ready', this.onReady.bind(this));\r\n        this.on('stateChange', this.onStateChange.bind(this));\r\n        // this.on('objectChange', this.onObjectChange.bind(this));\r\n        // this.on('message', this.onMessage.bind(this));\r\n        this.on('unload', this.onUnload.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Is called when databases are connected and adapter received configuration.\r\n     */\r\n    private async onReady(): Promise<void> {\r\n        let tmpLoadError = false\r\n        /**Genreal */\r\n        if (this.config.intervall > 0) {\r\n            this.intervalTime = this.config.intervall;\r\n        } else {\r\n            this.log.error('Wrong intervall time');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.start_time > 0 && this.config.start_time < 3600) {\r\n            this.startTime = this.config.start_time;\r\n        } else {\r\n            this.log.error('Wrong starttimer time: ' + this.config.start_time.toString());\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.stop_time > 0 && this.config.stop_time < 3600) {\r\n            this.stopTime = this.config.stop_time;\r\n        } else {\r\n            this.log.error('Wrong stoptimer time: ' + this.config.stop_time.toString());\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        /** Grid */\r\n        if (this.config.grid_factor != 0) {\r\n            this.gridFactor = this.config.grid_factor;\r\n        } else {\r\n            this.log.error('Wrong grid factor:' + this.config.grid_factor.toString());\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.grid_id != '') {\r\n            this.subscribeForeignStatesAsync(this.config.grid_id);\r\n        } else {\r\n            this.log.error('Wrong grid id - no Samrtmeter found');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        /** Wallbox */\r\n        //Pr\u00FCfen ob wir Wallboxstatus haben\r\n        /*if (this.config.wallbox_enable_id != '') {\r\n            //Subscribe f\u00FCr \u00C4nderungen\r\n            this.subscribeForeignStatesAsync(this.config.wallbox_enable_id);\r\n            //holen den aktuellen status\r\n            const tmpState = await this.getStateAsync(this.config.wallbox_enable_id);\r\n            this.wallboxEnable = tmpState?.val ? true : false;\r\n        } else {\r\n            this.log.error('Wrong wallbox status id - no boolean found');\r\n            tmpLoadError = true;\r\n        }*/\r\n\r\n        //Pr\u00FCfen ob wir Wallbox ampere haben\r\n        if (this.config.wallbox_ampere_id_p1) {\r\n            //Subscribe f\u00FCr \u00C4nderungen\r\n            this.subscribeForeignStatesAsync(this.config.wallbox_ampere_id_p1);\r\n            //holen den aktuellen status\r\n            //const tmpState = await this.getForeignStateAsync(this.config.wallbox_ampere_id);\r\n            //this.wallboxAmpere = Number(tmpState?.val);\r\n        } else {\r\n            this.log.error('Wrong wallbox ampere id for phase 1 - no id found');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.wallbox_ampere_id_p2) {\r\n            //Subscribe f\u00FCr \u00C4nderungen\r\n            this.subscribeForeignStatesAsync(this.config.wallbox_ampere_id_p2);\r\n        } else {\r\n            this.log.error('Wrong wallbox ampere id for phase 2 - no id found');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.wallbox_ampere_id_p3) {\r\n            //Subscribe f\u00FCr \u00C4nderungen\r\n            this.subscribeForeignStatesAsync(this.config.wallbox_ampere_id_p3);\r\n        } else {\r\n            this.log.error('Wrong wallbox ampere id for phase 3 - no id found');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        /*if (this.config.wallbox_ampere_step > 0) {\r\n            this.stepAmpereWallbox = this.config.wallbox_ampere_step;\r\n        } else {\r\n            this.log.error('Wrong wallbox ampere step:' + this.config.wallbox_ampere_step.toString());\r\n            tmpLoadError = true;\r\n        }*/\r\n\r\n        if (this.config.wallbox_ampere_max > 0) {\r\n            this.maxWallboxAmpere = this.config.wallbox_ampere_max;\r\n        } else {\r\n            this.log.error('Wrong wallbox max ampere :' + this.config.wallbox_ampere_max.toString());\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.wallbox_ampere_min > 0) {\r\n            this.minWallboxAmpere = this.config.wallbox_ampere_min;\r\n        } else {\r\n            this.log.error('Wrong wallbox max ampere :' + this.config.wallbox_ampere_min.toString());\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        /** Vehicle */\r\n        //Pr\u00FCfen ob wir Autosstatus haben\r\n        if (this.config.vehicle_pluged_id) {\r\n            //Subscribe f\u00FCr \u00C4nderungen\r\n            this.subscribeForeignStatesAsync(this.config.vehicle_pluged_id);\r\n            //holen den aktuellen status\r\n            const tmpState = await this.getForeignStateAsync(this.config.vehicle_pluged_id);\r\n            this.isPluged = tmpState?.val? true: false;\r\n        } else {\r\n            this.log.error('Wrong vehicle pluged id - no boolean found');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (this.config.vehicle_soc_id) {\r\n            //Subscribe f\u00FCr \u00C4nderungen\r\n            this.subscribeForeignStatesAsync(this.config.vehicle_soc_id);\r\n            //holen den aktuellen status\r\n            const tmpState = await this.getForeignStateAsync(this.config.vehicle_soc_id);\r\n            this.vehicleSoc = Number(tmpState?.val);\r\n        } else {\r\n            this.log.error('Wrong vehicle SoC id - no number found');\r\n            tmpLoadError = true;\r\n        }\r\n\r\n        if (!tmpLoadError) {\r\n            this.log.info('loading complete - all data present');\r\n\r\n            //Listen to control button\r\n            this.subscribeStatesAsync('control.start');\r\n            this.subscribeStatesAsync('control.stop');\r\n            this.subscribeStatesAsync('control.refresh');\r\n\r\n            //Initial wallbox all to 0\r\n            await this.stopWallBox();\r\n\r\n            //start watchdog\r\n            this.watchdogInterval = this.setInterval(async ()=> {\r\n                this.log.debug('Check Intervall tick');\r\n                await this.checkPvControl();\r\n            }, this.intervalTime * 1000);\r\n\r\n        } else {\r\n            this.log.info('loading incomplete - mising data');\r\n        }\r\n    }\r\n\r\n    private onUnload(callback: () => void): void {\r\n        try {\r\n            clearTimeout(this.stopTimer);\r\n            clearTimeout(this.startTimer);\r\n\r\n            clearInterval(this.watchdogInterval);\r\n            callback();\r\n        } catch (e) {\r\n            callback();\r\n        }\r\n    }\r\n\r\n\r\n    private async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\r\n        if (state) {\r\n            switch(id) {\r\n                case this.config.grid_id:\r\n                    this.log.debug('Become nvalue for - grid: ' + state.val?.toString());\r\n                    await this.setGridValue(state.val)\r\n                    break;\r\n                case this.config.vehicle_pluged_id:\r\n                    this.log.debug('Become new value for - Vehicle pluged: ' + state.val?.toString());\r\n                    this.isPluged = state.val ? true : false\r\n                    break;\r\n                case this.config.vehicle_soc_id:\r\n                    this.log.debug('Become new value for - Vehicle SoC: ' + state.val?.toString());\r\n                    this.vehicleSoc = state.val != null? +state.val : 0\r\n                    break;\r\n                case this.config.wallbox_ampere_id_p1:\r\n                case this.config.wallbox_ampere_id_p2:\r\n                case this.config.wallbox_ampere_id_p3:\r\n\r\n                    //this.log.debug('Become new value for - Wallbox ampere: ' + state.val?.toString());\r\n                    //this.wallboxAmpereP1 = state.val != null? +state.val : 0\r\n                    break;\r\n                default:\r\n                    const tmpControl = id.split('.')[3];\r\n                    this.log.debug(id);\r\n                    this.log.debug(tmpControl);\r\n                    switch (tmpControl) {\r\n                        case 'refresh':\r\n                            this.log.info('Forcing refresh');\r\n                            await this.checkPvControl();\r\n                            break;\r\n                        default:\r\n                            this.log.error('No supported event found');\r\n                            this.log.info(`state ${id} changed: ${state.val} (ack = ${state.ack})`);\r\n                    }\r\n            }\r\n        } else {\r\n            // The state was deleted\r\n            this.log.info(`state ${id} deleted`);\r\n        }\r\n    }\r\n\r\n    private async setGridValue(power: ioBroker.StateValue): Promise<void> {\r\n        if(power != null) {\r\n            this.currentPower = +power * this.gridFactor\r\n            this.setStateAsync('information.currentGridPower', this.currentPower, true);\r\n        } else {\r\n            this.currentPower = 0;\r\n        }\r\n\r\n        //DEMO Mode\r\n        this.currentPower = this.currentPower + 5000;\r\n\r\n        this.log.debug('currentPower:' + this.currentPower.toString());\r\n    }\r\n\r\n    private async stopWallBox(): Promise<void> {\r\n        this.wallboxAmpereP1 = 0;\r\n        this.wallboxAmpereP2 = 0;\r\n        this.wallboxAmpereP3 = 0;\r\n\r\n        this.setForeignState(this.config.wallbox_ampere_id_p1, this.wallboxAmpereP1);\r\n        this.setForeignState(this.config.wallbox_ampere_id_p2, this.wallboxAmpereP2);\r\n        this.setForeignState(this.config.wallbox_ampere_id_p3, this.wallboxAmpereP3);\r\n\r\n        //setzen noch globale Z\u00E4hler\r\n        this.wallboxAmpereComplete = this.wallboxAmpereP1 + this.wallboxAmpereP2 + this.wallboxAmpereP3;\r\n\r\n    }\r\n\r\n    private async setWallbox(ampere: number): Promise<void> {\r\n        let tmpChangeWallbox = false;\r\n\r\n        // ampere k\u00F6nnen wir erh\u00F6hen oder reduzieren\r\n        const newAmpereComplete = this.wallboxAmpereComplete + ampere\r\n\r\n        //K\u00F6nnen die Ladeleistung um die Amperezahl \u00E4nderm\r\n        if (newAmpereComplete >= this.maxWallboxAmpere * 3) { // * 3 wegen 3 Phasen\r\n            // Haben mehr AMpere zur Verf\u00FCgung als die Wallbox kann, p\u00FCrfen ob wir scho auf max sind?\r\n            if(this.wallboxAmpereP1 < this.maxWallboxAmpere || this.wallboxAmpereP2 < this.maxWallboxAmpere || this.wallboxAmpereP3 < this.maxWallboxAmpere ) {\r\n                //Mindest eine Phase hat zu wenig, setzen also alle Phasen neu\r\n                this.log.debug('More power as the max Wallbox, set to maxAmpere to Wallbox');\r\n                this.wallboxAmpereP1 = this.maxWallboxAmpere;\r\n                this.wallboxAmpereP2 = this.maxWallboxAmpere;\r\n                this.wallboxAmpereP3 = this.maxWallboxAmpere;\r\n                tmpChangeWallbox = true;\r\n            } else {\r\n                this.log.debug('More power as the max Wallbox, wallbox is on max - nothing changed');\r\n            }\r\n        } else {\r\n            //Haben mehr Leistung vom Dach als die Wallbox derzeit eingetsellt hat\r\n            this.log.debug('Have New Ampere for Wallbox, add: ' + ampere.toString());\r\n\r\n            //Pr\u00FCfen ob wir mehr als 1 Phase haben\r\n            // Mindestelsitung der Wallbox auf allen Phasen vorhanden\r\n            if(newAmpereComplete >= (this.minWallboxAmpere * 3)) {\r\n                //3 Phasiges Laden m\u00F6glich, also erh\u00F6hen wir jede Phase um 1/3\r\n                this.wallboxAmpereP1 = newAmpereComplete / 3;\r\n                this.wallboxAmpereP2 = newAmpereComplete / 3;\r\n                this.wallboxAmpereP3 = newAmpereComplete / 3;\r\n                tmpChangeWallbox = true;\r\n            } else {\r\n                //Haben nur 1 Phasig gen\u00FCgend power\r\n\r\n                if (newAmpereComplete > this.maxWallboxAmpere) {\r\n                    //Haben das maximal einer Phase erreicht:\r\n                    this.wallboxAmpereP1 = this.maxWallboxAmpere\r\n                    tmpChangeWallbox = true;\r\n                }\r\n\r\n                if (newAmpereComplete < this.minWallboxAmpere) {\r\n                    //Habe nicht gen\u00FCgend Power zum weiterladen - starte Stoptimer\r\n                    this.wallboxAmpereP1 = this.minWallboxAmpere\r\n                    tmpChangeWallbox = true;\r\n\r\n                    //stop all after timer\r\n                    this.checkStopTimer();\r\n                }\r\n\r\n                //Haben keine MAx und keinen stop, also dynamsich\r\n                if (!tmpChangeWallbox) {\r\n                    this.wallboxAmpereP1 = newAmpereComplete;\r\n                    tmpChangeWallbox = true;\r\n                }\r\n\r\n                //Rest Phasen bei 1 Phasig ausmachen\r\n                this.wallboxAmpereP2 = 0;\r\n                this.wallboxAmpereP3 = 0;\r\n                tmpChangeWallbox = true;\r\n            }\r\n        }\r\n\r\n        //Logig beendet, setzen die WErte in die Wallbox\r\n        if (tmpChangeWallbox) {\r\n            this.setForeignState(this.config.wallbox_ampere_id_p1, this.wallboxAmpereP1);\r\n            this.setForeignState(this.config.wallbox_ampere_id_p2, this.wallboxAmpereP2);\r\n            this.setForeignState(this.config.wallbox_ampere_id_p3, this.wallboxAmpereP3);\r\n\r\n            //setzen noch globale Z\u00E4hler\r\n            this.wallboxAmpereComplete = this.wallboxAmpereP1 + this.wallboxAmpereP2 + this.wallboxAmpereP3;\r\n        }\r\n    }\r\n\r\n    private async checkPvControl():Promise<void> {\r\n        //Pr\u00FCfen ob das Auto bereit ist\r\n        if(this.isPluged && this.vehicleSoc < 100) {\r\n            this.log.debug('vehicle ready  - check PV Power');\r\n\r\n            //Sind wir im PV Modus?\r\n            if (this.mode == 'PV') {\r\n                //PV Modus - Laden das Auto dynamisch\r\n                //this.log.warn(((this.getAmpereFromWatt(this.currentPower)/this.stepAmpereWallbox) * this.stepAmpereWallbox).toString());\r\n                //this.log.warn((Math.floor(this.getAmpereFromWatt(this.currentPower)/this.stepAmpereWallbox) * this.stepAmpereWallbox).toString());\r\n                const tmpWallboxAmpere = Math.floor(this.getAmpereFromWatt(this.currentPower)/this.stepAmpereWallbox) * this.stepAmpereWallbox;\r\n\r\n                if(this.getAmpereFromWatt(this.currentPower) > this.stepAmpereWallbox) {\r\n                    // Haben gen\u00FCgend Energie f\u00FCr eine Wallboxstep\r\n                    this.log.debug('Have enough power - set Wallbox : ' + tmpWallboxAmpere.toString());\r\n                    await this.setWallbox(tmpWallboxAmpere);\r\n                } else {\r\n                    // leider nicht gen\u00FCgend f\u00FCr ein Step - aber ist Netzbezug schon?\r\n                    if(this.currentPower < 0) {\r\n                        //Setze Wallbox niedriger\r\n                        this.log.debug('Have not enough power - set Wallbox down: ' + tmpWallboxAmpere.toString());\r\n                        await this.setWallbox(tmpWallboxAmpere);\r\n                    } else {\r\n                        // Kein Netzbezug, k\u00F6nnen so laufen lassen\r\n                        this.log.debug('Have not enough power to increase wallbox');\r\n                    }\r\n                }\r\n            } else {\r\n                // Laden noch nicht - sind im Timer?\r\n                if(this.getAmpereFromWatt(this.currentPower) > this.minWallboxAmpere) {\r\n                    // Haben gen\u00FCgend Energie f\u00FCr eine Wallboxstep\r\n                    this.log.debug('Have enough power to start');\r\n                    this.checkStartTimer();\r\n                } else {\r\n                    // nicht gen\u00FCgend Energie, also wieder aus\r\n                    this.log.debug('Have not enough power');\r\n                    if (this.mode != 'stop') {\r\n                        this.checkStopTimer();\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            this.log.info('Vehicle not ready or full charged - stop all');\r\n            if(this.mode== 'PV') {\r\n                await this.stopPV();\r\n            }\r\n        }\r\n    }\r\n\r\n    private checkStartTimer(): void{\r\n        this.log.debug('check Start timer is ready');\r\n        if (this.runStopTimer) {\r\n            this.log.info('Stop Stoptimer - enough power');\r\n            clearTimeout(this.stopTimer)\r\n            this.runStopTimer = false ;\r\n        }\r\n        if(!this.runStartTimer) {\r\n            this.log.info('Start Starttimer - enough power');\r\n            this.startTimer = this.setTimeout(async () => {\r\n                this.log.debug('Start timer finished');\r\n                await this.startPV()\r\n                this.runStartTimer = false;\r\n            }, this.startTime);\r\n            this.runStartTimer = true;\r\n        }\r\n    }\r\n\r\n    private checkStopTimer(): void{\r\n        this.log.debug('check Stop timer is ready');\r\n        if (this.runStartTimer) {\r\n            this.log.info('Stop Starttimer - not enough power');\r\n            clearTimeout(this.startTimer)\r\n            this.runStartTimer = false;\r\n        }\r\n\r\n        if(!this.runStopTimer) {\r\n            this.log.info('Start Stoptimer - not enough power');\r\n            this.stopTimer = this.setTimeout(async () => {\r\n                this.log.debug('Stop timer finished');\r\n                await this.stopPV()\r\n                this.runStopTimer = false;\r\n            }, this.stopTime);\r\n            this.runStopTimer = true;\r\n        }\r\n    }\r\n\r\n    private async startPV(): Promise<void> {\r\n        await this.setMode('PV');\r\n    }\r\n\r\n    private async stopPV(): Promise<void> {\r\n        await this.setMode('stop');\r\n\r\n        // Stoppen Wallbox\r\n        this.stopWallBox(); //Schalten Laden ab\r\n    }\r\n\r\n    private async setMode(mode: string): Promise<void> {\r\n        this.mode = mode;\r\n        await this.setStateAsync('information.mode', mode, true);\r\n    }\r\n\r\n    private getAmpereFromWatt(watt: number): number{\r\n        return watt/230;\r\n    }\r\n\r\n    private getWattFromAmpere(ampere: number): number {\r\n        return ampere * 230;\r\n    }\r\n\r\n    /*private async setWallboxStateAsync(id: string, value: string | boolean | number, ack = true): Promise<void> {\r\n\r\n        //await this.setForeignStateAsync(id, value, ack);\r\n\r\n        //TODO Easee aufteilen auf 3 calls\r\n        if (typeof value == 'number') {\r\n\r\n            //Phasenumschaltung berechnen\r\n            // Wenn wir minampere * 3 haben, k\u00F6nnn wir auf 3 Phasig wechseln\r\n            // Beispielsweise 6 * = 18\r\n            const tmp3Phasig = Math.floor(value/3)\r\n            if(tmp3Phasig >= this.minWallboxAmpere) {\r\n                this.log.debug('Setze 3Phasige Ladung an')\r\n                if (tmp3Phasig > this.maxWallboxAmpere) {\r\n                    this.log.debug('Setze 3Phasige Ladung mit maximaler Ampere')\r\n                    this.setForeignState(this.config.wallbox_ampere_id_1, this.maxWallboxAmpere);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_2, this.maxWallboxAmpere);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_3, this.maxWallboxAmpere);\r\n                } else {\r\n                    this.log.debug('Setze 3Phasige Ladung mit dynamischer Ampere')\r\n                    this.setForeignState(this.config.wallbox_ampere_id_1, tmp3Phasig);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_2, tmp3Phasig);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_3, tmp3Phasig);\r\n                }\r\n            } else {\r\n                // haben nicht genug f\u00FCr 3 Phasen also bei 1 Phasig bleiben\r\n                if (value > this.maxWallboxAmpere) {\r\n                    this.log.debug('Setze 1Phasige Ladung mit maximaler Ampere')\r\n                    this.setForeignState(this.config.wallbox_ampere_id_1, this.maxWallboxAmpere);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_2, 0);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_3, 0);\r\n                } else {\r\n                    this.log.debug('Setze 1Phasige Ladung mit dynamischer Ampere')\r\n                    this.setForeignState(this.config.wallbox_ampere_id_1, value);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_2, 0);\r\n                    this.setForeignState(this.config.wallbox_ampere_id_3, 0);\r\n                }\r\n            }\r\n            await this.setForeignStateAsync('0_userdata.0.tmpWallboxAmpere', value, ack);\r\n        }\r\n    }*/\r\n}\r\n\r\nif (require.main !== module) {\r\n    // Export the constructor in compact mode\r\n    module.exports = (options: Partial<utils.AdapterOptions> | undefined) => new PvPowerConrol(options);\r\n} else {\r\n    // otherwise start the instance directly\r\n    (() => new PvPowerConrol())();\r\n}"],
  "mappings": "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",
  "names": []
}
